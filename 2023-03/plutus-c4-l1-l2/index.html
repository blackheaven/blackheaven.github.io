<!DOCTYPE html>
<html lang="en" data-theme="dark">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="base" content="https://blackheaven.github.io">

    
    <title>Gautier DI FOLCO • Plutus: Pioneers Program 4th cohort kick start</title>

    
    
        <link rel="icon" type="image/png" href="https://blackheaven.github.io/favicon-16x16.png"/>
    
    

    
    
        
            
            
                
                    <link rel="alternate" type="application/atom+xml" title="Gautier DI FOLCO - Atom Feed" href="https://blackheaven.github.io/atom.xml">
                
            
        
    

    
    
    
        <link rel="stylesheet" href="https://blackheaven.github.io/inter_subset_en.css?h=d8cf4ad058d6c3a4015b">
    

    
        <link rel="stylesheet" href="https://blackheaven.github.io/main.css?h=4709f1203e8bd6b4162f" />
        <link rel="stylesheet" href="https://blackheaven.github.io/skins/blue.css?h=a4dc1e94d3f5759784d2" />

    <meta name="color-scheme" content="dark" />
        <meta name="description" content="A software engineer website" />
        <meta property="og:description" content="A software engineer website" />

    
        <meta name="robots" content="index, nofollow" />
    

    <meta property="og:title" content="Plutus: Pioneers Program 4th cohort kick start" />
    <meta property="og:type" content="article" />

    

    <meta property="og:locale" content="en_GB" />

    <meta property="og:url" content="https:&#x2F;&#x2F;blackheaven.github.io&#x2F;2023-03&#x2F;plutus-c4-l1-l2&#x2F;" /><meta property="og:site_name" content="Gautier DI FOLCO"><meta http-equiv="Content-Security-Policy"
content="default-src 'self';font-src &#x27;self&#x27; data: 'self';img-src &#x27;self&#x27; https:&#x2F;&#x2F;* data:;media-src &#x27;self&#x27;;style-src &#x27;self&#x27; 'unsafe-inline';frame-src player.vimeo.com https:&#x2F;&#x2F;www.youtube-nocookie.com;connect-src 'self';script-src 'self' 'self'">
<script defer src="https://blackheaven.github.io/search_index.en.js?h=9ff10f9e8fb83581467d"></script>
        <script defer src="https://blackheaven.github.io/js/searchElasticlunr.min.js?h=3626c0ef99daa745b31e"></script>

        </head>


<body>
    <header>
    <nav class="navbar">
        <div class="nav-title">
            <a class="home-title" href="https://blackheaven.github.io">Gautier DI FOLCO</a>
        </div>
            <div class="nav-navs">
                <ul>
                        
                            <li>
                                
                                <a class="nav-links no-hover-padding" href="https://blackheaven.github.io/foss/">
                                FOSS Contributions
                                </a>
                            </li>
                        
                            <li>
                                
                                <a class="nav-links no-hover-padding" href="https://blackheaven.github.io/activities/">
                                Activities
                                </a>
                            </li>
                        
                            <li>
                                
                                <a class="nav-links no-hover-padding" href="https://blackheaven.github.io/hiring/">
                                Hire me
                                </a>
                            </li>
                        
                            <li>
                                
                                <a class="nav-links no-hover-padding" href="https://blackheaven.github.io/talks/">
                                Talks
                                </a>
                            </li>
                        
                            <li>
                                
                                <a class="nav-links no-hover-padding" href="https://blackheaven.github.io/blog/">
                                Posts
                                </a>
                            </li>
                        
                            <li>
                                
                                <a class="nav-links no-hover-padding" href="https://blackheaven.github.io/categories/">
                                Categories
                                </a>
                            </li>
                        
                            <li>
                                
                                <a class="nav-links no-hover-padding" href="https://blackheaven.github.io/tags/">
                                Tags
                                </a>
                            </li>
                        <div class="nav-navs" id="menu-icons-group">
                        <li class="js">
                            <div role="button" tabindex="0" id="search-button" class="search-icon interactive-icon" title="Click or press $SHORTCUT to open search" aria-label="Click or press $SHORTCUT to open search">
                                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 -960 960 960">
                                    <path d="M784-120 532-372q-30 24-69 38t-83 14q-109 0-184.5-75.5T120-580q0-109 75.5-184.5T380-840q109 0 184.5 75.5T640-580q0 44-14 83t-38 69l252 252-56 56ZM380-400q75 0 127.5-52.5T560-580q0-75-52.5-127.5T380-760q-75 0-127.5 52.5T200-580q0 75 52.5 127.5T380-400Z"/>
                                </svg>
                            </div>
                        </li>

                        
                        

                        </div>
                </ul>
            </div>
        
    </nav>
</header>

    <div class="content">

        
        




<main>
    <article>
        <h1 class="article-title">
            Plutus: Pioneers Program 4th cohort kick start
        </h1>

        <ul class="meta">
                <li>5th Mar 2023</li>
                <li title="857 words"><span class='separator' aria-hidden='true'>•</span>5 min read</li><li class="tag"><span class='separator' aria-hidden='true'>•</span>Tags:&nbsp;</li><li class="tag"><a href="https://blackheaven.github.io/tags/haskell/">haskell</a>,&nbsp;</li><li class="tag"><a href="https://blackheaven.github.io/tags/cardano/">cardano</a>,&nbsp;</li><li class="tag"><a href="https://blackheaven.github.io/tags/smart-contracts/">smart contracts</a></li>
        </ul>

        <section class="body"><p>For a long time I have been interested in blockchain ecosystem for multiple reasons:</p>
<ul>
<li>A wide range of applications</li>
<li>A very innovative field</li>
<li>Lots of advanced technical topics (which are considered "exotic" in day-to-day production code)</li>
<li>An open ecosystem (aligned with my <a href="https://blackheaven.github.io/foss/">FOSS contributions</a>)</li>
</ul>
<p>Which leds me to take <a rel="noopener" target="_blank" href="https://github.com/blackheaven/plutus-pioneer-program/tree/black-solutions">Plutus Pioneers Program: 1st Cohort</a> two years ago.</p>
<p>My experience with the course was deceiving because:</p>
<ul>
<li>it was mostly focused on overcoming Haskell mindset specificities (making the homeworks too simple for me)</li>
<li>no action from me (I was just watching the lectures, solving homeworks in few minutes, checking them in the playground)</li>
</ul>
<p>Since I plan to be involved in blockchains in a near future, it was a good opportunity to register for the <a rel="noopener" target="_blank" href="https://github.com/blackheaven/plutus-pioneer-program/tree/fourth-iteration-black">4th Cohort</a> just starting.</p>
<p>Note that it will be a new logs series in which I'll try to document the evolutions of my understanding, I don't intend to provide an uptodate reference of Cardano or Plutus.</p>
<p>Addionally to my <a href="https://blackheaven.github.io/activities/">regular look for contributions</a>, I'm willing to accept Plutus smart contracts suggestions.</p>
<p>Importants links:</p>
<ul>
<li>Github: <a rel="noopener" target="_blank" href="https://github.com/input-output-hk/plutus-pioneer-program/tree/fourth-iteration">https://github.com/input-output-hk/plutus-pioneer-program/tree/fourth-iteration</a></li>
<li>Gitbook: <a rel="noopener" target="_blank" href="https://iog-academy.gitbook.io/plutus-pioneers-program-fourth-cohort/">https://iog-academy.gitbook.io/plutus-pioneers-program-fourth-cohort/</a> (currently outdated)</li>
<li>Cardano 101: <a rel="noopener" target="_blank" href="https://www.essentialcardano.io/article/what-is-cardano-cardano-101">https://www.essentialcardano.io/article/what-is-cardano-cardano-101</a></li>
</ul>
<p>Main differences compare to the 1st cohort:</p>
<ul>
<li>Homeworks are coming with tests: a great point as I was lacking of feedbacks previously, being unsure I was doing the right thing</li>
<li>Lectures are shorter and more focused</li>
<li>Nix support dropped in favor in devcontainers: which is understandable but which is too bad since my switch to NixOS</li>
</ul>
<p>Let's start with some definitions:</p>
<ul>
<li><a rel="noopener" target="_blank" href="https://input-output-hk.github.io/cardano-wallet/design/Eras">Era</a>: hard fork changing non-backward-compatible blocks production behavior</li>
<li><a rel="noopener" target="_blank" href="https://roadmap.cardano.org/en/">Phase</a>: big focus of the Cardano Foundation (with multiple Eras), Voltaire focuses on Governance meaning, making Cardano self-sustainable, independant from IOHK</li>
<li><a rel="noopener" target="_blank" href="https://docs.cardano.org/learn/stake-pools">Stake pool</a>: Stable <a rel="noopener" target="_blank" href="https://docs.cardano.org/new-to-cardano/cardano-nodes">node</a> responsible of processing transactions going to the ledger</li>
<li><a rel="noopener" target="_blank" href="https://iohk.io/en/blog/posts/2022/06/03/from-classic-to-chronos-the-implementations-of-ouroboros-explained/">Ourobos</a>: Consensus protocol (from the greek, snake eating its own tail)</li>
<li>Block: Cryptographically verified set of transactions and previous-block reference</li>
<li>Slot: 1 second time-slice, for each slot, elected leaders propose blocks, only one of them are selected, others are discarded</li>
<li>Epoch: 432.000 slots (5 days)</li>
<li>Elected leaders: elected for 20 slots, due to the proof of stake base of <em>Ourobos</em>, the more <em>stake</em> a <em>stake pool</em> manage, the higher share a <em>stake pool</em> manage, the higher chance it has to be elected, they are expected to validate transactions</li>
<li>Smart-contract: Immutable piece of code which defines the conditions triggering the transaction</li>
<li>Transaction: changes on the blockchain's stakes</li>
<li><a rel="noopener" target="_blank" href="https://docs.cardano.org/plutus/learn-about-plutus">Plutus core</a>: Native on-chain script language used by Cardano for <em>smart-contracts</em> (it is compiled from the <em>Plutus Application</em> by the <em>Plutus Tx Compiler</em>, <em>Plutus Tx</em>, a GHC plug-in)</li>
<li><a rel="noopener" target="_blank" href="https://github.com/input-output-hk/plutus-apps#the-plutus-application-framework">Plutus Application Framework</a>: basis used for <em>Plutus Applications</em>, providing a HTTP and Websocket interface</li>
<li>Plutus Application Backend: executes off-chain part of an application, provides an HTTP API, manages requests to the node and the wallet while maintaining the application state</li>
<li>Collateral: monetary deposit used only if the smart contract fails on-chain (supposed to avoid malicious actors)</li>
</ul>
<p>A transaction is composed of:</p>
<ul>
<li>inputs: which are spent by <em>redeemers</em> (which are <em>Datum</em> values)</li>
<li>outputs: which are scripts validating spending associated currencies, and can come with <em>Datum</em></li>
</ul>
<p>A <em>Datum</em> looks like <a rel="noopener" target="_blank" href="https://hackage.haskell.org/package/aeson-2.1.2.1/docs/Data-Aeson.html#t:Value">aeson's <code>Value</code></a>:</p>
<pre data-lang="haskell" class="language-haskell z-code"><code class="language-haskell" data-lang="haskell"><span class="z-source z-haskell"><span class="z-keyword z-other z-haskell">data</span> <span class="z-constant z-other z-haskell">Data</span>
</span><span class="z-source z-haskell">  <span class="z-keyword z-operator z-haskell">=</span> <span class="z-constant z-other z-haskell">Constr</span> <span class="z-constant z-other z-haskell">Integer</span> [<span class="z-constant z-other z-haskell">Data</span>]
</span><span class="z-source z-haskell">  <span class="z-keyword z-operator z-haskell">|</span> <span class="z-constant z-other z-haskell">Map</span> [(<span class="z-constant z-other z-haskell">Data</span><span class="z-punctuation z-separator z-comma z-haskell">,</span> <span class="z-constant z-other z-haskell">Data</span>)]
</span><span class="z-source z-haskell">  <span class="z-keyword z-operator z-haskell">|</span> <span class="z-constant z-other z-haskell">List</span> [<span class="z-constant z-other z-haskell">Data</span>]
</span><span class="z-source z-haskell">  <span class="z-keyword z-operator z-haskell">|</span> <span class="z-constant z-other z-haskell">I</span> <span class="z-constant z-other z-haskell">Integer</span>
</span><span class="z-source z-haskell">  <span class="z-keyword z-operator z-haskell">|</span> <span class="z-constant z-other z-haskell">B</span> <span class="z-constant z-other z-haskell">ByteString</span>
</span></code></pre>
<p>But, if we have a look at a simple validator script:</p>
<pre data-lang="haskell" class="language-haskell z-code"><code class="language-haskell" data-lang="haskell"><span class="z-source z-haskell"><span class="z-comment z-line z-double-dash z-haskell"><span class="z-punctuation z-definition z-comment z-haskell">--</span> This validator succeeds only if the redeemer is 42
</span></span><span class="z-source z-haskell"><span class="z-comment z-line z-double-dash z-haskell"><span class="z-punctuation z-definition z-comment z-haskell">--</span>                  Datum         Redeemer     ScriptContext
</span></span><span class="z-source z-haskell"><span class="z-meta z-function z-type-declaration z-haskell"><span class="z-entity z-name z-function z-haskell">mk42Validator</span> <span class="z-keyword z-other z-double-colon z-haskell">::</span> <span class="z-storage z-type z-haskell">BuiltinData</span> <span class="z-keyword z-other z-arrow z-haskell">-&gt;</span> <span class="z-storage z-type z-haskell">BuiltinData</span> <span class="z-keyword z-other z-arrow z-haskell">-&gt;</span> <span class="z-storage z-type z-haskell">BuiltinData</span> <span class="z-keyword z-other z-arrow z-haskell">-&gt;</span> <span class="z-support z-constant z-unit z-haskell">()</span>
</span></span><span class="z-source z-haskell"><span class="z-meta z-function z-type-declaration z-haskell"></span>mk42Validator _ r _
</span><span class="z-source z-haskell">    <span class="z-keyword z-operator z-haskell">|</span> r <span class="z-keyword z-operator z-haskell">==</span> <span class="z-constant z-other z-haskell">Builtins</span><span class="z-keyword z-operator z-haskell">.</span>mkI <span class="z-constant z-numeric z-integer z-decimal z-haskell">42</span> <span class="z-keyword z-operator z-haskell">=</span> <span class="z-constant z-language z-unit z-haskell">()</span>
</span><span class="z-source z-haskell">    <span class="z-keyword z-operator z-haskell">|</span> otherwise            <span class="z-keyword z-operator z-haskell">=</span> traceError <span class="z-string z-quoted z-double z-haskell"><span class="z-punctuation z-definition z-string z-begin z-haskell">&quot;</span>expected 42<span class="z-punctuation z-definition z-string z-end z-haskell">&quot;</span></span>
</span><span class="z-source z-haskell"><span class="z-meta z-preprocessor z-haskell">{-# <span class="z-keyword z-other z-preprocessor z-haskell">INLINABLE</span> mk42Validator #-}</span>
</span><span class="z-source z-haskell">
</span><span class="z-source z-haskell"><span class="z-meta z-function z-type-declaration z-haskell"><span class="z-entity z-name z-function z-haskell">validator</span> <span class="z-keyword z-other z-double-colon z-haskell">::</span> <span class="z-storage z-type z-haskell">PlutusV2</span>.<span class="z-storage z-type z-haskell">Validator</span>
</span></span><span class="z-source z-haskell"><span class="z-meta z-function z-type-declaration z-haskell"></span>validator <span class="z-keyword z-operator z-haskell">=</span> <span class="z-constant z-other z-haskell">PlutusV2</span><span class="z-keyword z-operator z-haskell">.</span>mkValidatorScript <span class="z-keyword z-operator z-haskell">$$</span>(<span class="z-constant z-other z-haskell">PlutusTx</span><span class="z-keyword z-operator z-haskell">.</span>compile <span class="z-meta z-other z-quasiquote z-haskell"><span class="z-keyword z-other z-quasibracket z-haskell">[|</span><span class="z-string z-quasiquoted z-haskell">| mk42Validator |</span><span class="z-keyword z-other z-quasibracket z-haskell">|]</span></span>)
</span></code></pre>
<p>We can notice that:</p>
<ul>
<li>The validator function uses <code>BuiltinData</code> (and not <code>Data</code>)</li>
<li>The validator function is <code>INLINABLE</code>, to be <code>compile</code>d and inlined in <code>Validator</code></li>
<li>The validator function is a <code>()</code>, not a <code>Bool</code> or any <code>Monad</code></li>
</ul>
<p>Actually <code>BuiltinData</code> is the <em>Plutus Core</em> equivalent of <code>Data</code>, going back and forth via:</p>
<pre data-lang="haskell" class="language-haskell z-code"><code class="language-haskell" data-lang="haskell"><span class="z-source z-haskell"><span class="z-meta z-declaration z-class z-haskell"><span class="z-keyword z-other z-haskell">class</span> <span class="z-entity z-other z-inherited-class z-haskell">ToData</span> (<span class="z-variable z-other z-generic-type z-haskell">a</span> :: <span class="z-entity z-other z-inherited-class z-haskell">Type</span>) <span class="z-keyword z-other z-haskell">where</span></span>
</span><span class="z-source z-haskell"><span class="z-meta z-function z-type-declaration z-haskell">    <span class="z-entity z-name z-function z-haskell">toBuiltinData</span> <span class="z-keyword z-other z-double-colon z-haskell">::</span> <span class="z-variable z-other z-generic-type z-haskell">a</span> <span class="z-keyword z-other z-arrow z-haskell">-&gt;</span> <span class="z-storage z-type z-haskell">BuiltinData</span>
</span></span><span class="z-source z-haskell"><span class="z-meta z-function z-type-declaration z-haskell">
</span></span><span class="z-source z-haskell"><span class="z-meta z-function z-type-declaration z-haskell"></span><span class="z-meta z-declaration z-class z-haskell"><span class="z-keyword z-other z-haskell">class</span> <span class="z-entity z-other z-inherited-class z-haskell">FromData</span> (<span class="z-variable z-other z-generic-type z-haskell">a</span> :: <span class="z-entity z-other z-inherited-class z-haskell">Type</span>) <span class="z-keyword z-other z-haskell">where</span></span>
</span><span class="z-source z-haskell"><span class="z-meta z-function z-type-declaration z-haskell">    <span class="z-entity z-name z-function z-haskell">fromBuiltinData</span> <span class="z-keyword z-other z-double-colon z-haskell">::</span> <span class="z-storage z-type z-haskell">BuiltinData</span> <span class="z-keyword z-other z-arrow z-haskell">-&gt;</span> <span class="z-storage z-type z-haskell">Maybe</span> <span class="z-variable z-other z-generic-type z-haskell">a</span>
</span></span><span class="z-source z-haskell"><span class="z-meta z-function z-type-declaration z-haskell">
</span></span><span class="z-source z-haskell"><span class="z-meta z-function z-type-declaration z-haskell"></span><span class="z-meta z-declaration z-class z-haskell"><span class="z-keyword z-other z-haskell">class</span> <span class="z-entity z-other z-inherited-class z-haskell">UnsafeFromData</span> (<span class="z-variable z-other z-generic-type z-haskell">a</span> :: <span class="z-entity z-other z-inherited-class z-haskell">Type</span>) <span class="z-keyword z-other z-haskell">where</span></span>
</span><span class="z-source z-haskell"><span class="z-meta z-function z-type-declaration z-haskell">    <span class="z-entity z-name z-function z-haskell">unsafeFromBuiltinData</span> <span class="z-keyword z-other z-double-colon z-haskell">::</span> <span class="z-storage z-type z-haskell">BuiltinData</span> <span class="z-keyword z-other z-arrow z-haskell">-&gt;</span> <span class="z-variable z-other z-generic-type z-haskell">a</span>
</span></span></code></pre>
<p>We can strengthen the types using <code>wrap</code> (which relies on <code>UnsafeFromData</code>):</p>
<pre data-lang="haskell" class="language-haskell z-code"><code class="language-haskell" data-lang="haskell"><span class="z-source z-haskell"><span class="z-meta z-function z-type-declaration z-haskell"><span class="z-entity z-name z-function z-haskell">mk42Validator</span> <span class="z-keyword z-other z-double-colon z-haskell">::</span> <span class="z-support z-constant z-unit z-haskell">()</span> <span class="z-keyword z-other z-arrow z-haskell">-&gt;</span> <span class="z-storage z-type z-haskell">Integer</span> <span class="z-keyword z-other z-arrow z-haskell">-&gt;</span> <span class="z-storage z-type z-haskell">PlutusV2</span>.<span class="z-storage z-type z-haskell">ScriptContext</span> <span class="z-keyword z-other z-arrow z-haskell">-&gt;</span> <span class="z-storage z-type z-haskell">Bool</span>
</span></span><span class="z-source z-haskell"><span class="z-meta z-function z-type-declaration z-haskell"></span>mk42Validator _ r _ <span class="z-keyword z-operator z-haskell">=</span> traceIfFalse <span class="z-string z-quoted z-double z-haskell"><span class="z-punctuation z-definition z-string z-begin z-haskell">&quot;</span>expected 42<span class="z-punctuation z-definition z-string z-end z-haskell">&quot;</span></span> <span class="z-keyword z-operator z-haskell">$</span> r <span class="z-keyword z-operator z-haskell">==</span> <span class="z-constant z-numeric z-integer z-decimal z-haskell">42</span>
</span><span class="z-source z-haskell"><span class="z-meta z-preprocessor z-haskell">{-# <span class="z-keyword z-other z-preprocessor z-haskell">INLINABLE</span> mk42Validator #-}</span>
</span><span class="z-source z-haskell">
</span><span class="z-source z-haskell"><span class="z-meta z-function z-type-declaration z-haskell"><span class="z-entity z-name z-function z-haskell">validator</span> <span class="z-keyword z-other z-double-colon z-haskell">::</span> <span class="z-storage z-type z-haskell">PlutusV2</span>.<span class="z-storage z-type z-haskell">Validator</span>
</span></span><span class="z-source z-haskell"><span class="z-meta z-function z-type-declaration z-haskell"></span>validator <span class="z-keyword z-operator z-haskell">=</span> <span class="z-constant z-other z-haskell">PlutusV2</span><span class="z-keyword z-operator z-haskell">.</span>mkValidatorScript <span class="z-keyword z-operator z-haskell">$$</span>(<span class="z-constant z-other z-haskell">PlutusTx</span><span class="z-keyword z-operator z-haskell">.</span>compile <span class="z-meta z-other z-quasiquote z-haskell"><span class="z-keyword z-other z-quasibracket z-haskell">[|</span><span class="z-string z-quasiquoted z-haskell">| wrap mk42Validator |</span><span class="z-keyword z-other z-quasibracket z-haskell">|]</span></span>)
</span></code></pre>
<p>You can also create specific types thanks to <code>unstableMakeIsData</code>:</p>
<pre data-lang="haskell" class="language-haskell z-code"><code class="language-haskell" data-lang="haskell"><span class="z-source z-haskell"><span class="z-keyword z-other z-haskell">data</span> <span class="z-constant z-other z-haskell">MyRedeemer</span> <span class="z-keyword z-operator z-haskell">=</span> <span class="z-constant z-other z-haskell">MyRedeemer</span>
</span><span class="z-source z-haskell">    { flag1 <span class="z-keyword z-operator z-haskell">::</span> <span class="z-constant z-other z-haskell">Bool</span>
</span><span class="z-source z-haskell">    <span class="z-punctuation z-separator z-comma z-haskell">,</span> flag2 <span class="z-keyword z-operator z-haskell">::</span> <span class="z-constant z-other z-haskell">Bool</span>
</span><span class="z-source z-haskell">    }
</span><span class="z-source z-haskell">
</span><span class="z-source z-haskell"><span class="z-constant z-other z-haskell">PlutusTx</span><span class="z-keyword z-operator z-haskell">.</span>unstableMakeIsData &#39;&#39;<span class="z-constant z-other z-haskell">MyRedeemer</span>
</span></code></pre>
<p>Let's try a simple validator checking the factorization of a number:</p>
<pre data-lang="haskell" class="language-haskell z-code"><code class="language-haskell" data-lang="haskell"><span class="z-source z-haskell"><span class="z-comment z-line z-double-dash z-haskell"><span class="z-punctuation z-definition z-comment z-haskell">--</span>              Datum  Redeemer        ScriptContext
</span></span><span class="z-source z-haskell"><span class="z-meta z-function z-type-declaration z-haskell"><span class="z-entity z-name z-function z-haskell">mkValidator</span> <span class="z-keyword z-other z-double-colon z-haskell">::</span> <span class="z-storage z-type z-haskell">Integer</span> <span class="z-keyword z-other z-arrow z-haskell">-&gt;</span> (<span class="z-storage z-type z-haskell">Integer</span>, <span class="z-storage z-type z-haskell">Integer</span>) <span class="z-keyword z-other z-arrow z-haskell">-&gt;</span> <span class="z-storage z-type z-haskell">PlutusV2</span>.<span class="z-storage z-type z-haskell">ScriptContext</span> <span class="z-keyword z-other z-arrow z-haskell">-&gt;</span> <span class="z-storage z-type z-haskell">Bool</span>
</span></span><span class="z-source z-haskell"><span class="z-meta z-function z-type-declaration z-haskell"></span>mkValidator t (x<span class="z-punctuation z-separator z-comma z-haskell">,</span> y) _ <span class="z-keyword z-operator z-haskell">=</span> shouldNotBeOne x &amp;&amp; shouldNotBeOne y &amp;&amp; shouldBeFactors
</span><span class="z-source z-haskell">  <span class="z-keyword z-other z-haskell">where</span> shouldNotBeOne <span class="z-keyword z-operator z-haskell">::</span> <span class="z-constant z-other z-haskell">Integer</span> <span class="z-keyword z-operator z-haskell">-&gt;</span> <span class="z-constant z-other z-haskell">Bool</span>
</span><span class="z-source z-haskell">        shouldNotBeOne n <span class="z-keyword z-operator z-haskell">=</span> traceIfFalse <span class="z-string z-quoted z-double z-haskell"><span class="z-punctuation z-definition z-string z-begin z-haskell">&quot;</span>No factor should be 1<span class="z-punctuation z-definition z-string z-end z-haskell">&quot;</span></span> <span class="z-keyword z-operator z-haskell">$</span> n <span class="z-keyword z-operator z-haskell">/=</span> <span class="z-constant z-numeric z-integer z-decimal z-haskell">1</span>
</span><span class="z-source z-haskell">        shouldBeFactors  <span class="z-keyword z-operator z-haskell">=</span> traceIfFalse <span class="z-string z-quoted z-double z-haskell"><span class="z-punctuation z-definition z-string z-begin z-haskell">&quot;</span>Not factors<span class="z-punctuation z-definition z-string z-end z-haskell">&quot;</span></span> <span class="z-keyword z-operator z-haskell">$</span> x * y <span class="z-keyword z-operator z-haskell">==</span> t
</span><span class="z-source z-haskell"><span class="z-meta z-preprocessor z-haskell">{-# <span class="z-keyword z-other z-preprocessor z-haskell">INLINABLE</span> mkValidator #-}</span>
</span><span class="z-source z-haskell">
</span><span class="z-source z-haskell"><span class="z-meta z-function z-type-declaration z-haskell"><span class="z-entity z-name z-function z-haskell">validator</span> <span class="z-keyword z-other z-double-colon z-haskell">::</span> <span class="z-storage z-type z-haskell">PlutusV2</span>.<span class="z-storage z-type z-haskell">Validator</span>
</span></span><span class="z-source z-haskell"><span class="z-meta z-function z-type-declaration z-haskell"></span>validator <span class="z-keyword z-operator z-haskell">=</span> <span class="z-constant z-other z-haskell">PlutusV2</span><span class="z-keyword z-operator z-haskell">.</span>mkValidatorScript <span class="z-keyword z-operator z-haskell">$$</span>(<span class="z-constant z-other z-haskell">PlutusTx</span><span class="z-keyword z-operator z-haskell">.</span>compile <span class="z-meta z-other z-quasiquote z-haskell"><span class="z-keyword z-other z-quasibracket z-haskell">[|</span><span class="z-string z-quasiquoted z-haskell">| wrap mkValidator |</span><span class="z-keyword z-other z-quasibracket z-haskell">|]</span></span>)
</span></code></pre>
<p>Compiling it to <em>Plutus Core</em> gives something like:</p>
<pre class="z-code"><code><span class="z-text z-plain">{
</span><span class="z-text z-plain">  &quot;type&quot;: &quot;PlutusScriptV2&quot;,
</span><span class="z-text z-plain">  &quot;description&quot;: &quot;&quot;,
</span><span class="z-text z-plain">  &quot;cborHex&quot;: &quot;5908...&quot;
</span><span class="z-text z-plain">}
</span></code></pre>
<p>CBOR standing for Concise Binary Object Representation and is specified by <a rel="noopener" target="_blank" href="https://tools.ietf.org/html/rfc7049">RFC 7049</a>.</p>
<p>Let's submit our contract with a random <em>Datum</em>:</p>
<pre class="z-code"><code><span class="z-text z-plain">{&quot;int&quot;:42}
</span></code></pre>
<p>We can check it works via:</p>
<pre class="z-code"><code><span class="z-text z-plain">$ scripts/query-address.sh $(cat code/Week02/experiments/factoring.addr)
</span><span class="z-text z-plain">                           TxHash                                 TxIx        Amount
</span><span class="z-text z-plain">--------------------------------------------------------------------------------------
</span><span class="z-text z-plain">2d1604d8ba3128cd1526b6c68f94f8eddcd83b530dda4560dd327f25ad39164d     0        3000000 lovelace + TxOutDatumInline ReferenceTxInsScriptsInlineDatumsInBabbageEra (ScriptDataNumber 42)
</span></code></pre>
<p>If we then try to collect (using bob's key address first transaction as collateral and above <em>TxHash</em> as <code>txin</code>) with an incorrect <em>Datum</em>:</p>
<pre class="z-code"><code><span class="z-text z-plain">$ code/Week02/experiments/collect.sh wrong
</span><span class="z-text z-plain"># Query the protocol parameters
</span><span class="z-text z-plain"># Build the transaction
</span><span class="z-text z-plain">Command failed: transaction build  Error: The following scripts have execution failures:
</span><span class="z-text z-plain">the script for transaction input 0 (in the order of the TxIds) failed with:
</span><span class="z-text z-plain">transaction input 0 (in the order of the TxIds) points to a script hash that is not known.
</span><span class="z-text z-plain">
</span><span class="z-text z-plain"># Sign the transaction
</span><span class="z-text z-plain"># Submit the transaction
</span><span class="z-text z-plain">Command failed: transaction submit  Error: Error while submitting tx: ShelleyTxValidationError ShelleyBasedEraBabbage (ApplyTxError [UtxowFailure (FromAlonzoUtxowFail (WrappedShelleyEraFailure (ExtraneousScriptWitnessesUTXOW (fromList [ScriptHash &quot;c06d15e27842d0ccd6c825a13b84830a14215e01c98a93567f8cdbf8&quot;])))),UtxowFailure (FromAlonzoUtxowFail (ExtraRedeemers [RdmrPtr Spend 0])),UtxowFailure (FromAlonzoUtxowFail (PPViewHashesDontMatch (SJust (SafeHash &quot;abb568f2abaa14e3f59d0feaceb981033fdb16850af8339863a05343d8ac19f6&quot;)) (SJust (SafeHash &quot;29f1fbb67e8a3f06db19ae5a5f8c6f51968e16920f3b486925beafd1c3e27391&quot;)))),UtxowFailure (UtxoFailure (FromAlonzoUtxoFail (ValueNotConservedUTxO (Value 0 (fromList [])) (Value 3000000 (fromList []))))),UtxowFailure (UtxoFailure (FromAlonzoUtxoFail (BadInputsUTxO (fromList [TxIn (TxId {_unTxId = SafeHash &quot;2d1604d8ba3128cd1526b6c68f94f8eddcd83b530dda4560dd327f25ad39164d&quot;}) (TxIx 0)]))))])
</span><span class="z-text z-plain">transaction id: ee269f32f5eb8abaf580f3684221c8c82066136e6e9ea7b8455fba61ee53f590
</span><span class="z-text z-plain">Cardanoscan: https://preview.cardanoscan.io/transaction/ee269f32f5eb8abaf580f3684221c8c82066136e6e9ea7b8455fba61ee53f590
</span></code></pre>
<p>if fails right away, without going to the blockchain, while a good <em>Datum</em> works:</p>
<pre class="z-code"><code><span class="z-text z-plain">$ code/Week02/experiments/collect.sh good
</span><span class="z-text z-plain">Transaction successfully submitted.
</span><span class="z-text z-plain">transaction id: ee269f32f5eb8abaf580f3684221c8c82066136e6e9ea7b8455fba61ee53f590
</span><span class="z-text z-plain">Cardanoscan: https://preview.cardanoscan.io/transaction/ee269f32f5eb8abaf580f3684221c8c82066136e6e9ea7b8455fba61ee53f590
</span></code></pre>
<p>Updating transactions:</p>
<pre class="z-code"><code><span class="z-text z-plain">$ scripts/query-address.sh $(cat keys/bob.addr)
</span><span class="z-text z-plain">TxHash                                 TxIx        Amount
</span><span class="z-text z-plain">--------------------------------------------------------------------------------------
</span><span class="z-text z-plain">2e1fe0fe79677804a70bff96b249d9912143a3464f4788d7a42b1f772bfb2050     0        10000000000 lovelace + TxOutDatumNone
</span><span class="z-text z-plain">ee269f32f5eb8abaf580f3684221c8c82066136e6e9ea7b8455fba61ee53f590     0        2701365 lovelace + TxOutDatumNone
</span><span class="z-text z-plain">$ scripts/query-address.sh $(cat keys/alice.addr)
</span><span class="z-text z-plain">TxHash                                 TxIx        Amount
</span><span class="z-text z-plain">--------------------------------------------------------------------------------------
</span><span class="z-text z-plain">2d1604d8ba3128cd1526b6c68f94f8eddcd83b530dda4560dd327f25ad39164d     1        9996833927 lovelace + TxOutDatumNone
</span><span class="z-text z-plain">$ scripts/query-address.sh $(cat code/Week02/experiments/factoring.addr)
</span><span class="z-text z-plain">TxHash                                 TxIx        Amount
</span><span class="z-text z-plain">--------------------------------------------------------------------------------------
</span></code></pre>
<p><em>Bonus</em>: At some point I did, mistakenly change the validator, which triggered this error:</p>
<pre class="z-code"><code><span class="z-text z-plain">Command failed: transaction build  Error: The following scripts have execution failures:
</span><span class="z-text z-plain">the script for transaction input 0 (in the order of the TxIds) failed with: 
</span><span class="z-text z-plain">The redeemer pointer: RdmrPtr Spend 0 points to a Plutus script that does not exist.
</span><span class="z-text z-plain">The pointers that can be resolved are: fromList [(RdmrPtr Spend 0,(Spending (TxIn (TxId {_unTxId = SafeHash &quot;2d1604d8ba3128cd1526b6c68f94f8eddcd83b530dda4560dd327f25ad39164d&quot;}) (TxIx 0)),Nothing,ScriptHash &quot;c06d15e27842d0ccd6c825a13b84830a14215e01c98a93567f8cdbf8&quot;))]
</span></code></pre>
<p>In order to detect it, you can recompute it with:</p>
<pre class="z-code"><code><span class="z-text z-plain">$ cardano-cli address build-script --testnet-magic 2 --script-file code/Week02/experiments/factoring.plutus
</span><span class="z-text z-plain">addr_test1wr5wslr3utlm0vccvveg2z4p0p0jp02fcrwmyeaqqwmglsc6urkf0
</span><span class="z-text z-plain">$ cat code/Week02/experiments/factoring.addr
</span><span class="z-text z-plain">addr_test1wrqx690z0ppdpnxkeqj6zwuysv9pgg27q8yc4y6k07xdh7qyreaje
</span></code></pre>

        </section>

        
        
        

        
            
            
            

            
        
            
            
            

            
        
            
            
            

            
        
            
            
            

            
        
        

    </article>
</main>


<script defer src="https://blackheaven.github.io/js/mermaid.min.js"></script><span id="copy-success" class="hidden">
        Copied!
    </span>
    <span id="copy-init" class="hidden">
        Copy code to clipboard
    </span>
    <script defer src="https://blackheaven.github.io/js/copyCodeToClipboard.min.js"></script>
    </div>
    <footer>
    <section>
        <nav class="socials nav-navs">
                <ul>
                    
                    
                    
                    <li>
                        <a class="nav-links no-hover-padding social" rel="noopener" target=_blank href="https://blackheaven.github.io/atom.xml">
                        <img loading="lazy" alt="feed" title="feed" src="https://blackheaven.github.io/social_icons/rss.svg">
                        </a>
                    </li><li class="js"><a class="nav-links no-hover-padding social" href="#" data-encoded-email="Z2F1dGllci5kaWZvbCtibG9nQGdtYWlsLmNvbQ=="><img loading="lazy" alt="email" title="email" src="https://blackheaven.github.io/social_icons/email.svg">
                            </a>
                        </li>
                        
                            <li>
                                <a class="nav-links no-hover-padding social" rel="noopener me" target=_blank href="https://www.linkedin.com/in/gautier-di-folco/">
                                    <img loading="lazy" alt="linkedin" title="linkedin" src="https://blackheaven.github.io/social_icons/linkedin.svg">
                                </a>
                            </li>
                        
                            <li>
                                <a class="nav-links no-hover-padding social" rel="noopener me" target=_blank href="https://github.com/blackheaven/">
                                    <img loading="lazy" alt="github" title="github" src="https://blackheaven.github.io/social_icons/github.svg">
                                </a>
                            </li>
                        
                    
                </ul>
            
        </nav>

        
        <nav class="nav-navs">
        </nav>

        <div class="credits">
            <small>
                

                
                Powered by
                <a rel="noopener" target=_blank href="https://www.getzola.org">Zola</a>
                &amp;
                <a rel="noopener" target=_blank href="https://github.com/welpo/tabi">tabi</a>

                </small>
        </div>
    </section>

    <script src="https://blackheaven.github.io/js/decodeMail.min.js" async></script><div id="searchModal" class="search-modal js" role="dialog" aria-labelledby="modalTitle">
    <h1 id="modalTitle" class="visually-hidden">Search</h1>
    <div id="modal-content">
        <div id="searchBar">
            <div class="search-icon" aria-hidden="true">
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 -960 960 960">
                    <path d="M784-120 532-372q-30 24-69 38t-83 14q-109 0-184.5-75.5T120-580q0-109 75.5-184.5T380-840q109 0 184.5 75.5T640-580q0 44-14 83t-38 69l252 252-56 56ZM380-400q75 0 127.5-52.5T560-580q0-75-52.5-127.5T380-760q-75 0-127.5 52.5T200-580q0 75 52.5 127.5T380-400Z"/>
                </svg>
            </div>
            <input id="searchInput" role="combobox" autocomplete="off" spellcheck="false" aria-expanded="false" aria-controls="results-container" placeholder="Search…"/>
            <div id="clear-search" class="close-icon interactive-icon" tabindex="0" role="button" title="Clear search">
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 -960 960 960">
                <path d="m256-200-56-56 224-224-224-224 56-56 224 224 224-224 56 56-224 224 224 224-56 56-224-224-224 224Z"/>
                </svg>
            </div>
        </div>
        <div id="results-container">
            <div id="results-info"><span id="zero_results"> No results</span>
                <span id="one_results"> $NUMBER result</span>
                <span id="many_results"> $NUMBER results</span><span id="two_results"> $NUMBER results</span>
                <span id="few_results"> $NUMBER results</span>
            </div>
            <div id="results" role="listbox"></div>
        </div>
    </div>
</div>
</footer>

</body>

</html>
