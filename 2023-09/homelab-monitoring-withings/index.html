<!DOCTYPE html>
<html lang="en" data-theme="dark">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="base" content="https://blackheaven.github.io">

    
    <title>Gautier DI FOLCO • Homelab: Monitoring Withings</title>

    
    
        <link rel="icon" type="image/png" href="https://blackheaven.github.io/favicon-16x16.png"/>
    
    

    
    
        
            
            
                
                    <link rel="alternate" type="application/atom+xml" title="Gautier DI FOLCO - Atom Feed" href="https://blackheaven.github.io/atom.xml">
                
            
        
    

    
    
    
        <link rel="stylesheet" href="https://blackheaven.github.io/inter_subset_en.css?h=d8cf4ad058d6c3a4015b">
    

    
        <link rel="stylesheet" href="https://blackheaven.github.io/main.css?h=4709f1203e8bd6b4162f" />
        <link rel="stylesheet" href="https://blackheaven.github.io/skins/blue.css?h=a4dc1e94d3f5759784d2" />

    <meta name="color-scheme" content="dark" />
        <meta name="description" content="A software engineer website" />
        <meta property="og:description" content="A software engineer website" />

    
        <meta name="robots" content="index, nofollow" />
    

    <meta property="og:title" content="Homelab: Monitoring Withings" />
    <meta property="og:type" content="article" />

    

    <meta property="og:locale" content="en_GB" />

    <meta property="og:url" content="https:&#x2F;&#x2F;blackheaven.github.io&#x2F;2023-09&#x2F;homelab-monitoring-withings&#x2F;" /><meta property="og:site_name" content="Gautier DI FOLCO"><meta http-equiv="Content-Security-Policy"
content="default-src 'self';font-src &#x27;self&#x27; data: 'self';img-src &#x27;self&#x27; https:&#x2F;&#x2F;* data:;media-src &#x27;self&#x27;;style-src &#x27;self&#x27; 'unsafe-inline';frame-src player.vimeo.com https:&#x2F;&#x2F;www.youtube-nocookie.com;connect-src 'self';script-src 'self' 'self'">
<script defer src="https://blackheaven.github.io/search_index.en.js?h=9ff10f9e8fb83581467d"></script>
        <script defer src="https://blackheaven.github.io/js/searchElasticlunr.min.js?h=3626c0ef99daa745b31e"></script>

        </head>


<body>
    <header>
    <nav class="navbar">
        <div class="nav-title">
            <a class="home-title" href="https://blackheaven.github.io">Gautier DI FOLCO</a>
        </div>
            <div class="nav-navs">
                <ul>
                        
                            <li>
                                
                                <a class="nav-links no-hover-padding" href="https://blackheaven.github.io/foss/">
                                FOSS Contributions
                                </a>
                            </li>
                        
                            <li>
                                
                                <a class="nav-links no-hover-padding" href="https://blackheaven.github.io/activities/">
                                Activities
                                </a>
                            </li>
                        
                            <li>
                                
                                <a class="nav-links no-hover-padding" href="https://blackheaven.github.io/hiring/">
                                Hire me
                                </a>
                            </li>
                        
                            <li>
                                
                                <a class="nav-links no-hover-padding" href="https://blackheaven.github.io/talks/">
                                Talks
                                </a>
                            </li>
                        
                            <li>
                                
                                <a class="nav-links no-hover-padding" href="https://blackheaven.github.io/blog/">
                                Posts
                                </a>
                            </li>
                        
                            <li>
                                
                                <a class="nav-links no-hover-padding" href="https://blackheaven.github.io/categories/">
                                Categories
                                </a>
                            </li>
                        
                            <li>
                                
                                <a class="nav-links no-hover-padding" href="https://blackheaven.github.io/tags/">
                                Tags
                                </a>
                            </li>
                        <div class="nav-navs" id="menu-icons-group">
                        <li class="js">
                            <div role="button" tabindex="0" id="search-button" class="search-icon interactive-icon" title="Click or press $SHORTCUT to open search" aria-label="Click or press $SHORTCUT to open search">
                                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 -960 960 960">
                                    <path d="M784-120 532-372q-30 24-69 38t-83 14q-109 0-184.5-75.5T120-580q0-109 75.5-184.5T380-840q109 0 184.5 75.5T640-580q0 44-14 83t-38 69l252 252-56 56ZM380-400q75 0 127.5-52.5T560-580q0-75-52.5-127.5T380-760q-75 0-127.5 52.5T200-580q0 75 52.5 127.5T380-400Z"/>
                                </svg>
                            </div>
                        </li>

                        
                        

                        </div>
                </ul>
            </div>
        
    </nav>
</header>

    <div class="content">

        
        




<main>
    <article>
        <h1 class="article-title">
            Homelab: Monitoring Withings
        </h1>

        <ul class="meta">
                <li>24th Sep 2023</li>
                <li title="389 words"><span class='separator' aria-hidden='true'>•</span>2 min read</li><li class="tag"><span class='separator' aria-hidden='true'>•</span>Tags:&nbsp;</li><li class="tag"><a href="https://blackheaven.github.io/tags/ops/">ops</a>,&nbsp;</li><li class="tag"><a href="https://blackheaven.github.io/tags/development/">development</a>,&nbsp;</li><li class="tag"><a href="https://blackheaven.github.io/tags/monitoring/">monitoring</a>,&nbsp;</li><li class="tag"><a href="https://blackheaven.github.io/tags/lgtm-stack/">lgtm-stack</a></li>
        </ul>

        <section class="body"><p>I have a simple morning routing starting with:</p>
<ul>
<li>Getting up</li>
<li>Opening the shutters</li>
<li>Making my bed</li>
<li>Petting my cat (eventually, opening the door to let her out)</li>
<li>Emptying my bladder</li>
<li>Getting on my Withings smart scale</li>
</ul>
<p>Each Sunday, I take additional measurements, and I log them and my week's
average week weight in a multiple-years LibreOffice Calc (don't judge...).</p>
<p>For the record, I was using Fitbit until <a rel="noopener" target="_blank" href="https://blog.google/products/devices-services/fitbit-acquisition/">Google acquired it</a>
(and degraded it: <a rel="noopener" target="_blank" href="https://www.makeuseof.com/ways-google-ruined-fitbit/">1</a>, <a rel="noopener" target="_blank" href="https://www.techradar.com/opinion/fitbit-as-we-know-it-is-already-dead-thanks-to-google">2</a>, <a rel="noopener" target="_blank" href="https://www.gizchina.com/2023/03/02/fitbit-is-dead-google-killed-it/">3</a>, etc.).</p>
<p>The thing is, there's no way to get week average weight, so, after few months
of manually making averages, I dirtily pushed <a rel="noopener" target="_blank" href="https://github.com/blackheaven/withings-weights">withings-weights</a>.</p>
<p>To illustrate my journey through <a href="https://blackheaven.github.io/2023-09/homelab-monitoring-withings/content/2023-09-06_homelab-monitoring-introduction.md">monitoring</a>
(especially <a href="https://blackheaven.github.io/2023-09/homelab-monitoring-alerting/">alerting</a>), I would like to
add some metrics and alert (as I would do for business systems).</p>
<p>I have found <a rel="noopener" target="_blank" href="https://hackage.haskell.org/package/prometheus-client">prometheus-client</a> on hackage
which is a great fit (and <a rel="noopener" target="_blank" href="https://hackage.haskell.org/package/prometheus-metrics-ghc">prometheus-metrics-ghc</a>, <a rel="noopener" target="_blank" href="https://hackage.haskell.org/package/servant-prometheus">servant-prometheus</a>, <a rel="noopener" target="_blank" href="https://hackage.haskell.org/package/wai-middleware-prometheus">wai-middleware-prometheus</a>).</p>
<p>Let's start with generic code:</p>
<pre data-lang="haskell" class="language-haskell z-code"><code class="language-haskell" data-lang="haskell"><span class="z-source z-haskell"><span class="z-meta z-import z-haskell"><span class="z-keyword z-other z-haskell">import</span> <span class="z-support z-other z-module z-haskell">Network.Wai.Middleware.Prometheus</span></span>
</span><span class="z-source z-haskell"><span class="z-meta z-import z-haskell"><span class="z-keyword z-other z-haskell">import</span> <span class="z-support z-other z-module z-haskell">Prometheus</span></span>
</span><span class="z-source z-haskell"><span class="z-meta z-import z-haskell"><span class="z-keyword z-other z-haskell">import</span> <span class="z-support z-other z-module z-haskell">Prometheus.Metric.GHC</span></span>
</span><span class="z-source z-haskell"><span class="z-meta z-import z-haskell"><span class="z-keyword z-other z-haskell">import</span> <span class="z-support z-other z-module z-haskell">Prometheus.Servant</span></span>
</span><span class="z-source z-haskell">
</span><span class="z-source z-haskell"><span class="z-meta z-function z-type-declaration z-haskell"><span class="z-entity z-name z-function z-haskell">main</span> <span class="z-keyword z-other z-double-colon z-haskell">::</span> <span class="z-storage z-type z-haskell">IO</span> <span class="z-support z-constant z-unit z-haskell">()</span>
</span></span><span class="z-source z-haskell"><span class="z-meta z-function z-type-declaration z-haskell"></span>main <span class="z-keyword z-operator z-haskell">=</span> <span class="z-keyword z-control z-haskell">do</span>
</span><span class="z-source z-haskell">  <span class="z-comment z-line z-double-dash z-haskell"><span class="z-punctuation z-definition z-comment z-haskell">--</span> ...
</span></span><span class="z-source z-haskell">  register ghcMetrics
</span><span class="z-source z-haskell">
</span><span class="z-source z-haskell">  <span class="z-keyword z-other z-haskell">let</span> servantPMW <span class="z-keyword z-operator z-haskell">=</span> prometheusMiddleware defaultMetrics <span class="z-keyword z-operator z-haskell">$</span> <span class="z-constant z-other z-haskell">Proxy</span> @<span class="z-constant z-other z-haskell">API</span>
</span><span class="z-source z-haskell">  run serverEnv<span class="z-keyword z-operator z-haskell">.</span>serverPort <span class="z-keyword z-operator z-haskell">$</span> prometheus def <span class="z-keyword z-operator z-haskell">$</span> servantPMW <span class="z-keyword z-operator z-haskell">$</span> app serverEnv oauthEnv info
</span></code></pre>
<p>We can highlight three parts in the above snippet:</p>
<ul>
<li><code>register ghcMetrics</code> add the GHC metrics in the global metric registry</li>
<li><code>prometheusMiddleware</code> is a middleware which collect metrics around <code>servant</code> endpoints</li>
<li><code>prometheus</code> is a middleware which add further instrumentation around <code>wai</code> and a <code>/metrics</code> endpoint to display collected metrics</li>
</ul>
<p>Then we can define few metrics:</p>
<pre data-lang="haskell" class="language-haskell z-code"><code class="language-haskell" data-lang="haskell"><span class="z-source z-haskell"><span class="z-keyword z-other z-haskell">data</span> <span class="z-constant z-other z-haskell">WithingsMetrics</span> <span class="z-keyword z-operator z-haskell">=</span> <span class="z-constant z-other z-haskell">WithingsMetrics</span>
</span><span class="z-source z-haskell">  { lastChecked <span class="z-keyword z-operator z-haskell">::</span> <span class="z-constant z-other z-haskell">Vector</span> <span class="z-constant z-other z-haskell">Text</span> <span class="z-constant z-other z-haskell">Gauge</span><span class="z-punctuation z-separator z-comma z-haskell">,</span>
</span><span class="z-source z-haskell"><span class="z-meta z-function z-type-declaration z-haskell">    <span class="z-entity z-name z-function z-haskell">lastWeight</span> <span class="z-keyword z-other z-double-colon z-haskell">::</span> <span class="z-storage z-type z-haskell">Vector</span> <span class="z-storage z-type z-haskell">Text</span> <span class="z-storage z-type z-haskell">Gauge</span>,
</span></span><span class="z-source z-haskell"><span class="z-meta z-function z-type-declaration z-haskell"></span><span class="z-meta z-function z-type-declaration z-haskell">    <span class="z-entity z-name z-function z-haskell">users</span> <span class="z-keyword z-other z-double-colon z-haskell">::</span> <span class="z-storage z-type z-haskell">Counter</span>
</span></span><span class="z-source z-haskell"><span class="z-meta z-function z-type-declaration z-haskell"></span>  }
</span></code></pre>
<p>There are few kind of metrics:</p>
<ul>
<li><code>Counter</code>: always increasing values</li>
<li><code>Gauge</code>: variable values</li>
<li><code>Summary</code>/<code>Histogram</code>: observations made over time</li>
</ul>
<p>all of them being floating point numbers (<code>Double</code>).</p>
<p><code>Vector a m</code> are partitioned metrics (<code>m</code>) or labels (<code>a</code>).</p>
<p>Let's instantiate them:</p>
<pre data-lang="haskell" class="language-haskell z-code"><code class="language-haskell" data-lang="haskell"><span class="z-source z-haskell"><span class="z-meta z-function z-type-declaration z-haskell"><span class="z-entity z-name z-function z-haskell">main</span> <span class="z-keyword z-other z-double-colon z-haskell">::</span> <span class="z-storage z-type z-haskell">IO</span> <span class="z-support z-constant z-unit z-haskell">()</span>
</span></span><span class="z-source z-haskell"><span class="z-meta z-function z-type-declaration z-haskell"></span>main <span class="z-keyword z-operator z-haskell">=</span> <span class="z-keyword z-control z-haskell">do</span>
</span><span class="z-source z-haskell">  <span class="z-comment z-line z-double-dash z-haskell"><span class="z-punctuation z-definition z-comment z-haskell">--</span> ...
</span></span><span class="z-source z-haskell">  register ghcMetrics
</span><span class="z-source z-haskell">  metrics <span class="z-keyword z-operator z-haskell">&lt;-</span>
</span><span class="z-source z-haskell">    <span class="z-constant z-other z-haskell">WithingsMetrics</span>
</span><span class="z-source z-haskell">      <span class="z-keyword z-operator z-haskell">&lt;$&gt;</span> register (vector <span class="z-string z-quoted z-double z-haskell"><span class="z-punctuation z-definition z-string z-begin z-haskell">&quot;</span>username<span class="z-punctuation z-definition z-string z-end z-haskell">&quot;</span></span> <span class="z-keyword z-operator z-haskell">$</span> gauge (<span class="z-constant z-other z-haskell">Info</span> <span class="z-string z-quoted z-double z-haskell"><span class="z-punctuation z-definition z-string z-begin z-haskell">&quot;</span>withings_last_checked<span class="z-punctuation z-definition z-string z-end z-haskell">&quot;</span></span> <span class="z-string z-quoted z-double z-haskell"><span class="z-punctuation z-definition z-string z-begin z-haskell">&quot;</span>Last time a User checked his/her stats<span class="z-punctuation z-definition z-string z-end z-haskell">&quot;</span></span>))
</span><span class="z-source z-haskell">      <span class="z-keyword z-operator z-haskell">&lt;</span>*<span class="z-keyword z-operator z-haskell">&gt;</span> register (vector <span class="z-string z-quoted z-double z-haskell"><span class="z-punctuation z-definition z-string z-begin z-haskell">&quot;</span>username<span class="z-punctuation z-definition z-string z-end z-haskell">&quot;</span></span> <span class="z-keyword z-operator z-haskell">$</span> gauge (<span class="z-constant z-other z-haskell">Info</span> <span class="z-string z-quoted z-double z-haskell"><span class="z-punctuation z-definition z-string z-begin z-haskell">&quot;</span>withings_last_weight<span class="z-punctuation z-definition z-string z-end z-haskell">&quot;</span></span> <span class="z-string z-quoted z-double z-haskell"><span class="z-punctuation z-definition z-string z-begin z-haskell">&quot;</span>Last User weight<span class="z-punctuation z-definition z-string z-end z-haskell">&quot;</span></span>))
</span><span class="z-source z-haskell">      <span class="z-keyword z-operator z-haskell">&lt;</span>*<span class="z-keyword z-operator z-haskell">&gt;</span> register (counter (<span class="z-constant z-other z-haskell">Info</span> <span class="z-string z-quoted z-double z-haskell"><span class="z-punctuation z-definition z-string z-begin z-haskell">&quot;</span>withings_users<span class="z-punctuation z-definition z-string z-end z-haskell">&quot;</span></span> <span class="z-string z-quoted z-double z-haskell"><span class="z-punctuation z-definition z-string z-begin z-haskell">&quot;</span>Users count<span class="z-punctuation z-definition z-string z-end z-haskell">&quot;</span></span>))
</span><span class="z-source z-haskell">
</span><span class="z-source z-haskell">  addCounter metrics<span class="z-keyword z-operator z-haskell">.</span>users <span class="z-keyword z-operator z-haskell">.</span> fromIntegral <span class="z-keyword z-operator z-haskell">.</span> length <span class="z-keyword z-operator z-haskell">=&lt;&lt;</span> runHandler (listUsers info)
</span><span class="z-source z-haskell">
</span><span class="z-source z-haskell">  <span class="z-keyword z-other z-haskell">let</span> servantPMW <span class="z-keyword z-operator z-haskell">=</span> prometheusMiddleware defaultMetrics <span class="z-keyword z-operator z-haskell">$</span> <span class="z-constant z-other z-haskell">Proxy</span> @<span class="z-constant z-other z-haskell">API</span>
</span><span class="z-source z-haskell">  run serverEnv<span class="z-keyword z-operator z-haskell">.</span>serverPort <span class="z-keyword z-operator z-haskell">$</span> prometheus def <span class="z-keyword z-operator z-haskell">$</span> servantPMW <span class="z-keyword z-operator z-haskell">$</span> app serverEnv oauthEnv info metrics
</span></code></pre>
<p>We can notice:</p>
<ul>
<li><code>Info</code> declares metric name and description</li>
<li><code>vector</code> declares labels</li>
</ul>
<p>Finally, we used <code>addCounter</code> to pre-populate user count at startup.</p>
<p>We can continue with endpoint instrumentation:</p>
<pre data-lang="haskell" class="language-haskell z-code"><code class="language-haskell" data-lang="haskell"><span class="z-source z-haskell"><span class="z-meta z-function z-type-declaration z-haskell"><span class="z-entity z-name z-function z-haskell">retrieveOauthHandler</span> <span class="z-keyword z-other z-double-colon z-haskell">::</span> <span class="z-storage z-type z-haskell">OauthEnv</span> <span class="z-keyword z-other z-arrow z-haskell">-&gt;</span> <span class="z-storage z-type z-haskell">UsersInfo</span> <span class="z-keyword z-other z-arrow z-haskell">-&gt;</span> <span class="z-storage z-type z-haskell">WithingsMetrics</span> <span class="z-keyword z-other z-arrow z-haskell">-&gt;</span> <span class="z-storage z-type z-haskell">Text</span> <span class="z-keyword z-other z-arrow z-haskell">-&gt;</span> <span class="z-storage z-type z-haskell">Text</span> <span class="z-keyword z-other z-arrow z-haskell">-&gt;</span> <span class="z-storage z-type z-haskell">Handler</span> <span class="z-storage z-type z-haskell">Text</span>
</span></span><span class="z-source z-haskell"><span class="z-meta z-function z-type-declaration z-haskell"></span>retrieveOauthHandler env info metrics code state <span class="z-keyword z-operator z-haskell">=</span> <span class="z-keyword z-control z-haskell">do</span>
</span><span class="z-source z-haskell">  user <span class="z-keyword z-operator z-haskell">&lt;-</span> fetchOauthTokens env info code state
</span><span class="z-source z-haskell">  liftIO <span class="z-keyword z-operator z-haskell">$</span> incCounter metrics<span class="z-keyword z-operator z-haskell">.</span>users
</span><span class="z-source z-haskell">  <span class="z-comment z-line z-double-dash z-haskell"><span class="z-punctuation z-definition z-comment z-haskell">--</span> ...
</span></span><span class="z-source z-haskell">
</span><span class="z-source z-haskell"><span class="z-meta z-function z-type-declaration z-haskell"><span class="z-entity z-name z-function z-haskell">statsHandler</span> <span class="z-keyword z-other z-double-colon z-haskell">::</span> <span class="z-storage z-type z-haskell">OauthEnv</span> <span class="z-keyword z-other z-arrow z-haskell">-&gt;</span> <span class="z-storage z-type z-haskell">UsersInfo</span> <span class="z-keyword z-other z-arrow z-haskell">-&gt;</span> <span class="z-storage z-type z-haskell">WithingsMetrics</span> <span class="z-keyword z-other z-arrow z-haskell">-&gt;</span> <span class="z-storage z-type z-haskell">UserName</span> <span class="z-keyword z-other z-arrow z-haskell">-&gt;</span> <span class="z-storage z-type z-haskell">Handler</span> <span class="z-storage z-type z-haskell">Text</span>
</span></span><span class="z-source z-haskell"><span class="z-meta z-function z-type-declaration z-haskell"></span>statsHandler env info metrics user <span class="z-keyword z-operator z-haskell">=</span> <span class="z-keyword z-control z-haskell">do</span>
</span><span class="z-source z-haskell">  groupedWeights <span class="z-keyword z-operator z-haskell">&lt;-</span> fetchStats <span class="z-keyword z-operator z-haskell">$</span> withOauthBearer env info user
</span><span class="z-source z-haskell">  <span class="z-keyword z-other z-haskell">let</span> fromFixed <span class="z-keyword z-operator z-haskell">::</span> (<span class="z-constant z-other z-haskell">Fractional</span> a<span class="z-punctuation z-separator z-comma z-haskell">,</span> <span class="z-constant z-other z-haskell">HasResolution</span> b) <span class="z-keyword z-operator z-haskell">=&gt;</span> <span class="z-constant z-other z-haskell">Fixed</span> b <span class="z-keyword z-operator z-haskell">-&gt;</span> a
</span><span class="z-source z-haskell">      fromFixed fv@(<span class="z-constant z-other z-haskell">MkFixed</span> v) <span class="z-keyword z-operator z-haskell">=</span> (fromIntegral v) <span class="z-keyword z-operator z-haskell">/</span> (fromIntegral <span class="z-keyword z-operator z-haskell">$</span> resolution fv)
</span><span class="z-source z-haskell">  nowGaugeValue <span class="z-keyword z-operator z-haskell">&lt;-</span> fromFixed <span class="z-keyword z-operator z-haskell">.</span> nominalDiffTimeToSeconds <span class="z-keyword z-operator z-haskell">.</span> utcTimeToPOSIXSeconds <span class="z-keyword z-operator z-haskell">&lt;$&gt;</span> liftIO getCurrentTime
</span><span class="z-source z-haskell">  liftIO <span class="z-keyword z-operator z-haskell">$</span>
</span><span class="z-source z-haskell">    withLabel metrics<span class="z-keyword z-operator z-haskell">.</span>lastChecked user<span class="z-keyword z-operator z-haskell">.</span>getUserName <span class="z-keyword z-operator z-haskell">$</span> <span class="z-keyword z-operator z-haskell">\</span>metric <span class="z-keyword z-operator z-haskell">-&gt;</span>
</span><span class="z-source z-haskell">      setGauge metric nowGaugeValue
</span><span class="z-source z-haskell">  <span class="z-comment z-line z-double-dash z-haskell"><span class="z-punctuation z-definition z-comment z-haskell">--</span> ...
</span></span></code></pre>
<p>So far so good, if we <code>curl</code> the <code>/metrics</code> endpoint:</p>
<pre class="z-code"><code><span class="z-text z-plain"># HELP withings_users Users count
</span><span class="z-text z-plain"># TYPE withings_users counter
</span><span class="z-text z-plain">withings_users 1.0
</span><span class="z-text z-plain"># HELP withings_last_checked Last time a User checked his/her stats
</span><span class="z-text z-plain"># TYPE withings_last_checked gauge
</span><span class="z-text z-plain">withings_last_checked{username=&quot;Gautier&quot;} 1.6955709670325263e9
</span><span class="z-text z-plain"># HELP withings_last_weight Last User weight
</span><span class="z-text z-plain"># TYPE withings_last_weight gauge
</span><span class="z-text z-plain">withings_last_weight{username=&quot;Gautier&quot;} 67.34
</span></code></pre>
<p>Finally we  can set up some rules:</p>
<pre data-lang="nix" class="language-nix z-code"><code class="language-nix" data-lang="nix"><span class="z-source z-nix"><span class="z-punctuation z-definition z-attrset-or-function z-nix">{</span>
</span><span class="z-source z-nix">  <span class="z-entity z-other z-attribute-name z-multipart z-nix">alert</span> <span class="z-keyword z-operator z-bind z-nix">=</span> <span class="z-string z-quoted z-double z-nix"><span class="z-punctuation z-definition z-string z-double z-start z-nix">&quot;</span>WeightLogForgotten<span class="z-punctuation z-definition z-string z-double z-end z-nix">&quot;</span></span><span class="z-punctuation z-terminator z-bind z-nix">;</span>
</span><span class="z-source z-nix">  <span class="z-entity z-other z-attribute-name z-multipart z-nix">for</span> <span class="z-keyword z-operator z-bind z-nix">=</span> <span class="z-string z-quoted z-double z-nix"><span class="z-punctuation z-definition z-string z-double z-start z-nix">&quot;</span>0m<span class="z-punctuation z-definition z-string z-double z-end z-nix">&quot;</span></span><span class="z-punctuation z-terminator z-bind z-nix">;</span>
</span><span class="z-source z-nix">  <span class="z-entity z-other z-attribute-name z-multipart z-nix">expr</span> <span class="z-keyword z-operator z-bind z-nix">=</span> <span class="z-string z-quoted z-other z-nix"><span class="z-punctuation z-definition z-string z-other z-start z-nix">&#39;&#39;</span>time() - withings_last_checked{username=&quot;Gautier&quot;} &gt; 691200<span class="z-punctuation z-definition z-string z-other z-end z-nix">&#39;&#39;</span></span><span class="z-punctuation z-terminator z-bind z-nix">;</span>
</span><span class="z-source z-nix">  <span class="z-entity z-other z-attribute-name z-multipart z-nix">labels</span>.<span class="z-entity z-other z-attribute-name z-multipart z-nix">severity</span> <span class="z-keyword z-operator z-bind z-nix">=</span> <span class="z-string z-quoted z-double z-nix"><span class="z-punctuation z-definition z-string z-double z-start z-nix">&quot;</span>info<span class="z-punctuation z-definition z-string z-double z-end z-nix">&quot;</span></span><span class="z-punctuation z-terminator z-bind z-nix">;</span>
</span><span class="z-source z-nix">  <span class="z-entity z-other z-attribute-name z-multipart z-nix">annotations</span>.<span class="z-entity z-other z-attribute-name z-multipart z-nix">summary</span> <span class="z-keyword z-operator z-bind z-nix">=</span> <span class="z-string z-quoted z-other z-nix"><span class="z-punctuation z-definition z-string z-other z-start z-nix">&#39;&#39;</span>Info: logging weights should be done (last time was &gt; 8 days ago)<span class="z-punctuation z-definition z-string z-other z-end z-nix">&#39;&#39;</span></span><span class="z-punctuation z-terminator z-bind z-nix">;</span>
</span><span class="z-source z-nix"><span class="z-punctuation z-definition z-attrset z-nix">}</span>
</span><span class="z-source z-nix"><span class="z-punctuation z-definition z-attrset-or-function z-nix">{</span>
</span><span class="z-source z-nix">  <span class="z-entity z-other z-attribute-name z-multipart z-nix">alert</span> <span class="z-keyword z-operator z-bind z-nix">=</span> <span class="z-string z-quoted z-double z-nix"><span class="z-punctuation z-definition z-string z-double z-start z-nix">&quot;</span>WeightUnder<span class="z-punctuation z-definition z-string z-double z-end z-nix">&quot;</span></span><span class="z-punctuation z-terminator z-bind z-nix">;</span>
</span><span class="z-source z-nix">  <span class="z-entity z-other z-attribute-name z-multipart z-nix">for</span> <span class="z-keyword z-operator z-bind z-nix">=</span> <span class="z-string z-quoted z-double z-nix"><span class="z-punctuation z-definition z-string z-double z-start z-nix">&quot;</span>0m<span class="z-punctuation z-definition z-string z-double z-end z-nix">&quot;</span></span><span class="z-punctuation z-terminator z-bind z-nix">;</span>
</span><span class="z-source z-nix">  <span class="z-entity z-other z-attribute-name z-multipart z-nix">expr</span> <span class="z-keyword z-operator z-bind z-nix">=</span> <span class="z-string z-quoted z-other z-nix"><span class="z-punctuation z-definition z-string z-other z-start z-nix">&#39;&#39;</span>withings_last_weight{username=&quot;Gautier&quot;} &lt; 66.5<span class="z-punctuation z-definition z-string z-other z-end z-nix">&#39;&#39;</span></span><span class="z-punctuation z-terminator z-bind z-nix">;</span>
</span><span class="z-source z-nix">  <span class="z-entity z-other z-attribute-name z-multipart z-nix">labels</span>.<span class="z-entity z-other z-attribute-name z-multipart z-nix">severity</span> <span class="z-keyword z-operator z-bind z-nix">=</span> <span class="z-string z-quoted z-double z-nix"><span class="z-punctuation z-definition z-string z-double z-start z-nix">&quot;</span>warning<span class="z-punctuation z-definition z-string z-double z-end z-nix">&quot;</span></span><span class="z-punctuation z-terminator z-bind z-nix">;</span>
</span><span class="z-source z-nix">  <span class="z-entity z-other z-attribute-name z-multipart z-nix">annotations</span>.<span class="z-entity z-other z-attribute-name z-multipart z-nix">summary</span> <span class="z-keyword z-operator z-bind z-nix">=</span> <span class="z-string z-quoted z-other z-nix"><span class="z-punctuation z-definition z-string z-other z-start z-nix">&#39;&#39;</span>Warning: you have lost too much weight (&lt; 66.5 kg), call your nutritionist<span class="z-punctuation z-definition z-string z-other z-end z-nix">&#39;&#39;</span></span><span class="z-punctuation z-terminator z-bind z-nix">;</span>
</span><span class="z-source z-nix"><span class="z-punctuation z-definition z-attrset z-nix">}</span>
</span><span class="z-source z-nix"><span class="z-punctuation z-definition z-attrset-or-function z-nix">{</span>
</span><span class="z-source z-nix">  <span class="z-entity z-other z-attribute-name z-multipart z-nix">alert</span> <span class="z-keyword z-operator z-bind z-nix">=</span> <span class="z-string z-quoted z-double z-nix"><span class="z-punctuation z-definition z-string z-double z-start z-nix">&quot;</span>WeightSignup<span class="z-punctuation z-definition z-string z-double z-end z-nix">&quot;</span></span><span class="z-punctuation z-terminator z-bind z-nix">;</span>
</span><span class="z-source z-nix">  <span class="z-entity z-other z-attribute-name z-multipart z-nix">for</span> <span class="z-keyword z-operator z-bind z-nix">=</span> <span class="z-string z-quoted z-double z-nix"><span class="z-punctuation z-definition z-string z-double z-start z-nix">&quot;</span>0m<span class="z-punctuation z-definition z-string z-double z-end z-nix">&quot;</span></span><span class="z-punctuation z-terminator z-bind z-nix">;</span>
</span><span class="z-source z-nix">  <span class="z-entity z-other z-attribute-name z-multipart z-nix">expr</span> <span class="z-keyword z-operator z-bind z-nix">=</span> <span class="z-string z-quoted z-other z-nix"><span class="z-punctuation z-definition z-string z-other z-start z-nix">&#39;&#39;</span>withings_users &gt; 1<span class="z-punctuation z-definition z-string z-other z-end z-nix">&#39;&#39;</span></span><span class="z-punctuation z-terminator z-bind z-nix">;</span>
</span><span class="z-source z-nix">  <span class="z-entity z-other z-attribute-name z-multipart z-nix">labels</span>.<span class="z-entity z-other z-attribute-name z-multipart z-nix">severity</span> <span class="z-keyword z-operator z-bind z-nix">=</span> <span class="z-string z-quoted z-double z-nix"><span class="z-punctuation z-definition z-string z-double z-start z-nix">&quot;</span>critical<span class="z-punctuation z-definition z-string z-double z-end z-nix">&quot;</span></span><span class="z-punctuation z-terminator z-bind z-nix">;</span>
</span><span class="z-source z-nix">  <span class="z-entity z-other z-attribute-name z-multipart z-nix">annotations</span>.<span class="z-entity z-other z-attribute-name z-multipart z-nix">summary</span> <span class="z-keyword z-operator z-bind z-nix">=</span> <span class="z-string z-quoted z-other z-nix"><span class="z-punctuation z-definition z-string z-other z-start z-nix">&#39;&#39;</span>Critical: someone signed up, you have been breached<span class="z-punctuation z-definition z-string z-other z-end z-nix">&#39;&#39;</span></span><span class="z-punctuation z-terminator z-bind z-nix">;</span>
</span><span class="z-source z-nix"><span class="z-punctuation z-definition z-attrset z-nix">}</span>
</span></code></pre>
<p>So far so good, on a real project, I would create an associated dashboard and
(probably) share it with stakeholders.</p>

        </section>

        
        
        

        
            
            
            

            
        
            
            
            

            
        
            
            
            

            
        
            
            
            

            
        
        

    </article>
</main>


<script defer src="https://blackheaven.github.io/js/mermaid.min.js"></script><span id="copy-success" class="hidden">
        Copied!
    </span>
    <span id="copy-init" class="hidden">
        Copy code to clipboard
    </span>
    <script defer src="https://blackheaven.github.io/js/copyCodeToClipboard.min.js"></script>
    </div>
    <footer>
    <section>
        <nav class="socials nav-navs">
                <ul>
                    
                    
                    
                    <li>
                        <a class="nav-links no-hover-padding social" rel="noopener" target=_blank href="https://blackheaven.github.io/atom.xml">
                        <img loading="lazy" alt="feed" title="feed" src="https://blackheaven.github.io/social_icons/rss.svg">
                        </a>
                    </li><li class="js"><a class="nav-links no-hover-padding social" href="#" data-encoded-email="Z2F1dGllci5kaWZvbCtibG9nQGdtYWlsLmNvbQ=="><img loading="lazy" alt="email" title="email" src="https://blackheaven.github.io/social_icons/email.svg">
                            </a>
                        </li>
                        
                            <li>
                                <a class="nav-links no-hover-padding social" rel="noopener me" target=_blank href="https://www.linkedin.com/in/gautier-di-folco/">
                                    <img loading="lazy" alt="linkedin" title="linkedin" src="https://blackheaven.github.io/social_icons/linkedin.svg">
                                </a>
                            </li>
                        
                            <li>
                                <a class="nav-links no-hover-padding social" rel="noopener me" target=_blank href="https://github.com/blackheaven/">
                                    <img loading="lazy" alt="github" title="github" src="https://blackheaven.github.io/social_icons/github.svg">
                                </a>
                            </li>
                        
                    
                </ul>
            
        </nav>

        
        <nav class="nav-navs">
        </nav>

        <div class="credits">
            <small>
                

                
                Powered by
                <a rel="noopener" target=_blank href="https://www.getzola.org">Zola</a>
                &amp;
                <a rel="noopener" target=_blank href="https://github.com/welpo/tabi">tabi</a>

                </small>
        </div>
    </section>

    <script src="https://blackheaven.github.io/js/decodeMail.min.js" async></script><div id="searchModal" class="search-modal js" role="dialog" aria-labelledby="modalTitle">
    <h1 id="modalTitle" class="visually-hidden">Search</h1>
    <div id="modal-content">
        <div id="searchBar">
            <div class="search-icon" aria-hidden="true">
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 -960 960 960">
                    <path d="M784-120 532-372q-30 24-69 38t-83 14q-109 0-184.5-75.5T120-580q0-109 75.5-184.5T380-840q109 0 184.5 75.5T640-580q0 44-14 83t-38 69l252 252-56 56ZM380-400q75 0 127.5-52.5T560-580q0-75-52.5-127.5T380-760q-75 0-127.5 52.5T200-580q0 75 52.5 127.5T380-400Z"/>
                </svg>
            </div>
            <input id="searchInput" role="combobox" autocomplete="off" spellcheck="false" aria-expanded="false" aria-controls="results-container" placeholder="Search…"/>
            <div id="clear-search" class="close-icon interactive-icon" tabindex="0" role="button" title="Clear search">
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 -960 960 960">
                <path d="m256-200-56-56 224-224-224-224 56-56 224 224 224-224 56 56-224 224 224 224-56 56-224-224-224 224Z"/>
                </svg>
            </div>
        </div>
        <div id="results-container">
            <div id="results-info"><span id="zero_results"> No results</span>
                <span id="one_results"> $NUMBER result</span>
                <span id="many_results"> $NUMBER results</span><span id="two_results"> $NUMBER results</span>
                <span id="few_results"> $NUMBER results</span>
            </div>
            <div id="results" role="listbox"></div>
        </div>
    </div>
</div>
</footer>

</body>

</html>
